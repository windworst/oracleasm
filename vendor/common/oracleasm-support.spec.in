#
# Spec file for oracleasm
#

# Macros
# This one is hardcoded because, well, it belongs there
%define _prefix /usr
# Because RPM is dumb
%define _unpackaged_files_terminate_build 0

# Turn on's and off's (summit and debug not used but added
# for future proofing)



Summary: The Oracle Automatic Storage Management support programs.
Name: oracleasm-support
Version: @DIST_VERSION@
Release: @RPM_VERSION@
Copyright: GPL
Group: System Environment/Kernel
Source: oracleasm-@DIST_VERSION@.tar.gz
URL: http://oss.oracle.com/projects/oracleasm/
Distribution: Oracle
Vendor: Oracle Corporation
Packager: Joel Becker <joel.becker@oracle.com>
AutoReqProv: no


BuildRoot: %{_tmppath}/oracleasm-%{PACKAGE_VERSION}-%{PACKAGE_RELEASE}-root



%description
Tools to manage the Oracle Automatic Storage Management library driver


%prep
%setup -n oracleasm-%{version}


%build
KPATH=/usr/src/linux-2.4
if [ ! -d "${KPATH}" ]
then
    KPATH=/usr/src/linux
fi
%configure --sbindir=/usr/sbin --with-kernel="${KPATH}"

cd tools
make
cd ..



%install

mkdir -p $RPM_BUILD_ROOT/etc/init.d
IVENDOR=redhat
if [ -r /etc/UnitedLinux-release -o -r /etc/SuSE-release ]
then
    IVENDOR=unitedlinux
fi
cp -f vendor/$IVENDOR/oracleasm.init $RPM_BUILD_ROOT/etc/init.d/oracleasm
mkdir -p $RPM_BUILD_ROOT/etc/sysconfig
cp -f vendor/common/oracleasm.sysconfig $RPM_BUILD_ROOT/etc/sysconfig/oracleasm
mkdir -p $RPM_BUILD_ROOT/usr/%{_lib}/oracleasm
cp -f vendor/common/oracleasm.init.functions $RPM_BUILD_ROOT/usr/%{_lib}/oracleasm/oracleasm.init.functions

cd tools
make DESTDIR="$RPM_BUILD_ROOT" install


%clean
rm -rf "$RPM_BUILD_ROOT"


%post
chkconfig oracleasm on
/etc/init.d/oracleasm link


%files
%defattr(-,root,root)
/usr/sbin/asmtool
/usr/sbin/asmscan
/usr/%{_lib}/oracleasm/oracleasm.init.functions
%attr(0755,root,root) /etc/init.d/oracleasm
%config /etc/sysconfig/oracleasm



%changelog
* Wed Jan 07 2004 Joel Becker <joel.becker@oracle.com>
- Make open package.

* Thu Dec 11 2003 Joel Becker <joel.becker@oracle.com>
- Try at userspace thingie.

* Wed Nov 12 2003 Joel Becker <joel.becker@oracle.com>
- Start the ASM rename.

* Thu Oct 30 2003 Joel Becker <joel.becker@oracle.com>
- Created EL3 version

* Mon Jun 23 2003 Joel Becker <joel.becker@oracle.com>
- Added osm-lib bits

* Fri Jun 20 2003 Joel Becker <joel.becker@oracle.com>
- Initial RPM

