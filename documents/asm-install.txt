
[ Installing ASMLib ]

This document describes the steps required to install the Linux specific
ASM library and its assocated driver.  This library is provide to enable
ASM I/O to Linux disks without the limitations of the standard Unix I/O
API.  The steps below are steps that the system administrator must
follow.

[ Locating the ASMLib Packages ]

The ASMLib software is on the Oracle RDBMS CDs.  Mount CD <insert CD
number here> as /mnt/cdrom.  If your CD-ROM drive is /dev/hdc, you can
mount it with the command:

	mount -t iso9660 /dev/hdc /mnt/cdrom

If you do not have the directory /mnt/cdrom, create it first.

Once you have mounted the CD, change into the ASM software directory.
This is <insert path on CD here>.  You can use the command:

	cd <insert path on CD here>

You now must choose the path for your appropriate Linux distribution and
hardware architecture.  Change into the correct directory:

	cd <insert dist+arch path here>

You will see 4-6 packages in this directory.  The 'asm-lib' package
provides the actual ASM library.  The 'asm-support' package provides the
utilities used to get the ASM driver up and running.  Both of these
packages need to be installed.

The remaining packages provide the kernel driver for the ASM library.
Each package provides the driver for a different kernel.  You must
install the appropriate package for the kernel you are running.  For
example, if you were running Red Hat Advanced Server 2.1, and the kernel
you were using was the 2.4.9-e.27enterprise kernel, you would choose the
asm-2.4.9-e-enterprise package.  So, to installing these packages on Red
Hat Advanced Server 2.1 on an Intel x86 machine, you would use the
command:

	rpm -Uvh oracleasm-support-1.0.0-1.i686.rpm oracleasm-lib-1.0.0-1.i686.rpm oracleasm-2.4.9-e-enterprise-1.0.0-1.i686.rpm

If you were on a different machine, the package names would be slightly
different, replacing 'i686' with the appropriate architecture.

Once the command completes, ASMLib is now installed on the system.

[ Configuring ASMLib ]

Now that the ASMLib software is installed, a few steps have to be taken
by the system administrator to make the ASM driver available.  The
ASM driver needs to be loaded, and the driver filesystem needs to be
mounted.  This is taken care of by the initialization script,
/etc/init.d/oracleasm.

Run the /etc/init.d/oracleasm script with the 'configure' option.  It
will ask for the user id and group id that default ot owning the ASM
driver access point.  If the 'oracle' user has a user id of 1001 and the
'dba' group has a groub id of 1005, the output would look like so:

	[root@ca-test1 /]# /etc/init.d/oracleasm configure
	Configuring the Oracle ASM library driver.
 
	This will configure the on-boot properties of the Oracle ASM library
	driver.  The following questions will determine whether the driver is
	loaded on boot and what permissions it will have.  The current values
	will be shown in brackets ('[]').  Hitting <ENTER> without typing an
	answer will keep that current value.  Ctrl-C will abort.

	Default UID to own the driver interface []: 1001
	Default GID to own the driver interface []: 1005
	Start Oracle ASM library driver on boot (y/n) [n]: y
	Writing Oracle ASM library driver configuration            [  OK  ]
	Creating /dev/oracleasm mount point                        [  OK  ]
	Loading module "oracleasm"                                 [  OK  ]
	Mounting ASMlib driver filesystem                          [  OK  ]


This should load the oracleasm.o driver module and mount the ASM driver
filesystem.  By selecting enabled = 'y' during the configuration, the
system will always load the module and mount the filesystem on boot.

The automatic start can be enabled or disabled with the 'enable' and
'disable' options to /etc/init.d/oracleasm:

	[root@ca-test1 /]# /etc/init.d/oracleasm disable
	Writing Oracle ASM library driver configuration            [  OK  ]
	Unmounting ASMlib driver filesystem                        [  OK  ]
	Unloading module "oracleasm"                               [  OK  ]

	[root@ca-test1 /]# /etc/init.d/oracleasm enable
	Writing Oracle ASM library driver configuration            [  OK  ]
	Loading module "oracleasm"                                 [  OK  ]
	Mounting ASMlib driver filesystem                          [  OK  ]


[ Making Disks Available to ASMLib ]

The system administrator has one last task.  Every disk that ASMLib is
going to be accessing needs to be made available.  This is accomplished
via two things.  The permissions of the disk device file must be such
that the database user or group ('oracle' and 'dba', in the above
example) can read the device file.  This can often be accomplished via
adding the database user to the 'disk' group or changing the ownership
of the disk device file to the database group.  To change the
group ownership of the SCSI disk /dev/sdg:

	chgrp dba /dev/sdg
	chmod g+r /dev/sdg

Finally, the disk must be 'marked' as an ASM disk.  The tool asmtool(8)
is used to mark the disk.  The '-m' option marks a disk, the '-u' option
unmarks a disk, and the '-c' option checks to see if a disk is marked.
To mark the disks /dev/sdg and /dev/sdh as ASM disks, use the command:

	asmtool -m /dev/sdg /dev/sdh

The ASM instance will now be able to load ASMLib and see the disks
/dev/sdg and /dev/sdh to access them via the library.  This only needs
to be done once for each disk.  It will be permanently marked on the
disk, so each disk will remain marked even if the server reboots.  Also,
other nodes in a RAC cluster will be able to see the marking.

